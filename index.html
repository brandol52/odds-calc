<!--
  Odds Calc ‚Äî Stake Window
  Build: Vhagar üî•üêâ
  Date: 2025-09-30
  Author: Bryan Randol
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Odds Calc ‚Äî Stake Window (Build-Vhagar üî•üêâ)</title>
  <meta name="theme-color" content="#5A1414">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/favicon.ico">
  <style>
    :root{ --bg:#0b1118; --fg:#eef1f5; --muted:#9aa4b2; --card:#0f172a; --border:#1c2234; --ok:#22c55e; --btn:#0b1324 }
    *{box-sizing:border-box}
    html,body{ margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif }
    .wrap{ max-width:560px; width:100%; margin:0 auto; padding:calc(10px + env(safe-area-inset-top)) calc(12px + env(safe-area-inset-right)) calc(10px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left)); display:grid; row-gap:8px; grid-template-rows:auto auto auto }
    h1{ margin:0 0 2px; font-size:16px }
    .muted{ color:var(--muted) } .small{ font-size:11px }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:8px }
    .row{ display:flex; gap:8px; align-items:center }
    .col{ flex:1 }
    label{ display:block; margin-bottom:4px; color:var(--muted); font-size:12px }
    .field{ position:relative }
    input[type=text]{ width:100%; background:#0a1324; border:1px solid var(--border); border-radius:8px; color:var(--fg); padding:8px 10px; font-size:15px; outline:none; -webkit-appearance:none }
    input[type=text]:focus{ border-color:#31405e; box-shadow:0 0 0 2px #31405e55 }
    .valid{ border-color:var(--ok) } .invalid{ border-color:#ef4444 }
    .err{ color:#ef4444; font-size:11px; margin-top:4px }
    button{ border:1px solid var(--border); background:var(--btn); color:var(--fg); border-radius:8px; padding:8px 10px; font-size:14px }

    .resultBox{ display:flex; flex-direction:column; gap:6px; padding:12px; background:#0c1428; border:1px solid var(--border); border-radius:12px; align-items:center; }
    .resultBox label{ font-size:12px; color:var(--muted); margin-bottom:4px }
    .amtLarge{ font-size:24px; font-weight:800; color:var(--ok); text-align:center }
    .breakevenSmall{ font-size:12px; color:var(--muted); text-align:center }

    input.valid:focus{ border-color:var(--ok); box-shadow:0 0 0 2px rgba(34,197,94,.3) }
    input.invalid, input.invalid:focus{ border-color:#ef4444 !important; box-shadow:0 0 0 2px rgba(239,68,68,.25) !important }

    .infoIcon{ color:var(--muted); font-size:0.85em; vertical-align:super; cursor:help }
    .infoIcon:hover{ color:#ffffff; }

    footer{ font-size:10.5px; color:var(--muted); text-align:center; padding:2px 0 4px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Stake Window</h1>
      <div class="muted small">Build-Vhagar üî•üêâ ‚Ä¢ Enter desired win + odds ‚Üí stakes</div>
    </header>

    <!-- Inputs -->
    <section class="card">
      <div class="row">
        <div class="col">
          <label for="win">Desired Win ($)</label>
          <div class="field">
            <input id="win" type="text" inputmode="numeric" placeholder="$0.00" autocomplete="off" autocorrect="off" spellcheck="false">
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="odds">American Odds</label>
          <div class="field">
            <input id="odds" type="text" inputmode="numeric" placeholder="+150 or -120" autocomplete="off" autocorrect="off" spellcheck="false" maxlength="6">
          </div>
          <div id="oddsErr" class="err" style="display:none" aria-live="polite">Invalid odds entered. (Must be at least +-100)</div>
        </div>
        <div>
          <label class="small muted">&nbsp;</label>
          <button id="toggleOdds" type="button" title="Flip sign">¬±</button>
        </div>
      </div>
      <div class="resultBox">
        <label>Required Stake</label>
        <div id="stakeOut" class="amtLarge">‚Äî</div>
        <div id="breakeven" class="breakevenSmall">Implied win probability <span class="infoIcon" title="This is the implied probability of winning at the entered odds (100/(odds+100) for positive odds, |odds|/(|odds|+100) for negative odds).">&#9432;</span>: <span id="probValue">‚Äî</span> <span id="favType"></span></div>
      </div>
    </section>

    <footer>
      Built by <strong>Bryan Randol</strong> ‚Ä¢ <strong>Build-Vhagar üî•üêâ</strong>
    </footer>
  </div>

<script>
// ===== Formatting & math helpers =====
const USD = new Intl.NumberFormat('en-US',{ style:'currency', currency:'USD', minimumFractionDigits:2, maximumFractionDigits:2 });
const fmtUSD = n => USD.format(n);
const fmtPct = p => (Number.isFinite(p)? (p*100).toFixed(2)+"%" : "‚Äî");

// Money helpers
function readMoney(el){
  const digits = (el.value.match(/\d+/g)||[]).join("");
  return digits==="" ? 0 : parseInt(digits,10)/100;
}
function maskMoneyCareful(el){
  const hasSel = typeof el.selectionEnd === 'number';
  const selEndFromRight = hasSel ? (el.value.length - el.selectionEnd) : 0;
  const digits = (el.value.match(/\d+/g)||[]).join("");
  const cents = digits==="" ? 0 : parseInt(digits,10);
  const next = USD.format((isNaN(cents)?0:cents)/100);
  el.value = next;
  if(hasSel){
    const pos = Math.max(0, el.value.length - selEndFromRight);
    requestAnimationFrame(()=>{ try{ el.setSelectionRange(pos,pos); }catch(_){} });
  }
}

// Odds parsing/validation
function readOdds(el){
  const t = (el.value||"").trim();
  if(!/^[-+]?\d+$/.test(t)) return NaN;
  return Number(t);
}
const isValidOdds = n => Number.isFinite(n) && Math.abs(n)>=100;
const americanToProb = o => (!Number.isFinite(o)||o===0)?NaN:(o>0? 100/(o+100) : Math.abs(o)/(Math.abs(o)+100));
const stakeForWin = (o,w) => (!Number.isFinite(o)||!Number.isFinite(w)||o===0)?NaN:(o>0? (w*100)/o : (w*Math.abs(o))/100);
const $ = id => document.getElementById(id);

function updateUI(){
  const winEl=$("win"), oddsEl=$("odds"), errEl=$("oddsErr");
  const win = readMoney(winEl);
  const o = readOdds(oddsEl);
  const okOdds = isValidOdds(o);
  const okWin = win>0;

  const hasValue = oddsEl.value.trim() !== "";
  oddsEl.classList.toggle("valid", hasValue && okOdds);
  oddsEl.classList.toggle("invalid", hasValue && !okOdds);
  oddsEl.setAttribute("aria-invalid", String(hasValue && !okOdds));
  errEl.style.display = (hasValue && !okOdds) ? "block" : "none";

  // Probability & favorite/longshot classification
  if(okOdds){
    $("probValue").textContent = fmtPct(americanToProb(o));
    let type = '';
    if(o === -100 || o === 100){
      type = '(Even)';
    } else if(o < -300){
      type = '(Heavy Favorite)';
    } else if(o < -150){
      type = '(Favorite)';
    } else if(o < -100){
      type = '(Slight Favorite)';
    } else if(o > 300){
      type = '(Lottery Ticket Play)';
    } else if(o > 200){
      type = '(Longshot)';
    } else if(o > 100){
      type = '(Slight Longshot)';
    }
    $("favType").textContent = type;
  } else {
    $("probValue").textContent = "‚Äî";
    $("favType").textContent = '';
  }

  // Stake requires both a positive win amount and valid odds
  $("stakeOut").textContent = (okWin && okOdds) ? fmtUSD(stakeForWin(o,win)) : "‚Äî";
}

function init(){
  const winEl=$("win"), oddsEl=$("odds");
  winEl.value = "$0.00";
  oddsEl.value = "";

  // Mask money on each input, then update UI
  winEl.addEventListener("input", ()=>{ maskMoneyCareful(winEl); updateUI(); }, {passive:true});
  winEl.addEventListener("blur", ()=>{ maskMoneyCareful(winEl); });

  // Odds input just updates UI
  oddsEl.addEventListener("input", updateUI, {passive:true});

  // Flip odds sign using numeric parse ‚Üí string with explicit sign
  $("toggleOdds").addEventListener("click", ()=>{
    const n = readOdds(oddsEl);
    if(!Number.isFinite(n)) return;
    const flipped = -n;
    oddsEl.value = (flipped>0? "+"+flipped : String(flipped));
    updateUI();
  });

  updateUI();
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}); }
}
if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", init); else init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Odds Calc — Stake Chart (Build-Meleys)</title>
  <meta name="theme-color" content="#5A1414">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/favicon.ico">
  <style>
    :root{
      --bg:#0b1118;--fg:#eef1f5;--muted:#9aa4b2;--card:#0f172a;--border:#1c2234;
      --stake:#22c55e;--btn:#0b1324;--btnActive:#18223a
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
    .wrap{
      max-width:560px;margin:0 auto;
      padding:calc(8px + env(safe-area-inset-top)) 10px 8px;
      display:grid;row-gap:8px;height:100%;
      grid-template-rows:auto auto 1fr auto;
    }
    h1{margin:0 0 2px;font-size:16px}
    .muted{color:var(--muted)} .small{font-size:11px}

    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px}
    label{display:block;margin-bottom:4px;color:var(--muted);font-size:12px}
    .field{position:relative}
    input[type=text]{width:100%;background:#0a1324;border:1px solid var(--border);border-radius:8px;color:var(--fg);
      padding:8px 10px;font-size:15px;outline:none;-webkit-appearance:none}
    input[type=text]:focus{border-color:#31405e;box-shadow:0 0 0 2px #31405e55}

    /* Range buttons: compact grid, 2 rows x 2 columns */
    .ranges{display:grid;grid-template-columns:1fr 1fr;gap:6px}
    .ranges button{
      border:1px solid var(--border);background:var(--btn);color:var(--fg);
      border-radius:8px;padding:8px 6px;font-size:13px;line-height:1.1
    }
    .ranges button.active{background:var(--btnActive);border-color:#2a3350}
    .ranges button small{display:block;color:var(--muted);font-size:10px;margin-top:2px}

    /* Chart – dense, fixed-height zone that fits viewport */
    .chartCard{gap:6px;padding:8px}
    .chartHeader{display:flex;justify-content:space-between;font-size:11px;color:var(--muted);padding:0 2px}
    .grid{
      column-count:12;                /* dense default */
      column-gap:4px;
      height:100%;
    }
    /* Adjust columns by screen width so rows stay ~8–10 high */
    @media (max-width:430px){ .grid{ column-count:12; } }
    @media (max-width:400px){ .grid{ column-count:11; } }
    @media (max-width:370px){ .grid{ column-count:10; } }

    .cell{
      break-inside:avoid;
      display:flex;justify-content:space-between;align-items:center;
      padding:4px 6px;margin:0 0 4px 0;border:1px solid var(--border);border-radius:6px;
      background:#0c1428;font-variant-numeric:tabular-nums;line-height:1.05;
      font-size:10.5px;min-height:18px
    }
    .odds{color:var(--muted)}
    .amt{font-weight:700;color:var(--stake);white-space:nowrap}

    footer{font-size:10.5px;color:var(--muted);text-align:center;padding:2px 0 4px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Stake Chart</h1>
      <div class="muted small">Build-Meleys • Enter desired win → tap a range</div>
    </header>

    <section class="card">
      <label for="win">Desired Win ($)</label>
      <div class="field">
        <input id="win" type="text" inputmode="numeric" placeholder="$0.00" autocomplete="off" autocorrect="off" spellcheck="false">
      </div>
      <div class="ranges" role="tablist" aria-label="Odds ranges">
        <button type="button" data-range="-500,-400" aria-selected="true" class="active" role="tab">−500…−400<small>step 1</small></button>
        <button type="button" data-range="-399,-300" role="tab">−399…−300<small>step 1</small></button>
        <button type="button" data-range="-299,-200" role="tab">−299…−200<small>step 1</small></button>
        <button type="button" data-range="-199,-100" role="tab">−199…−100<small>step 1</small></button>
      </div>
    </section>

    <section class="card chartCard">
      <div class="chartHeader">
        <div>American Odds</div>
        <div>Stake Required</div>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
    </section>

    <footer>
      Built by <strong>Bryan Randol</strong> • <strong>Build-Meleys</strong>
    </footer>
  </div>

<script>
const USD=new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:2,maximumFractionDigits:2});
const fmtUSD=n=>USD.format(n);
const readMoney=el=>{
  const digits=(el.value.match(/\d+/g)||[]).join("");
  return digits===""?0:parseInt(digits,10)/100;
};
function maskMoney(el){
  const digits=(el.value.match(/\d+/g)||[]).join("");
  const cents=digits===""?0:parseInt(digits,10);
  el.value=USD.format((isNaN(cents)?0:cents)/100);
}
function stakeForNegOdds(absNegOdds,win){return(win*absNegOdds)/100;}
function autoSize(cell){
  const amt=cell.querySelector('.amt'); if(!amt) return;
  const len=amt.textContent.length;
  if(len>12){ amt.style.fontSize="9px"; }
  else if(len>10){ amt.style.fontSize="9.8px"; }
  else{ amt.style.fontSize="10.5px"; }
}
function renderGrid(winAmt,start,end){
  const grid=document.getElementById('grid');
  grid.innerHTML="";
  for(let o=start;o<=end;o++){
    const stake=stakeForNegOdds(Math.abs(o),winAmt);
    const div=document.createElement('div'); div.className='cell';
    const odds=document.createElement('div'); odds.className='odds'; odds.textContent=String(o);
    const amt=document.createElement('div'); amt.className='amt'; amt.textContent=fmtUSD(stake);
    div.appendChild(odds); div.appendChild(amt); grid.appendChild(div);
    autoSize(div);
  }
}
function setActive(btn){
  document.querySelectorAll('.ranges button').forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false');});
  btn.classList.add('active'); btn.setAttribute('aria-selected','true');
}
function init(){
  const winEl=document.getElementById('win');
  const rangeButtons=[...document.querySelectorAll('.ranges button')];
  let currentRange=[-500,-400];

  // Initialize
  winEl.value="$0.00";
  renderGrid(0,currentRange[0],currentRange[1]);

  // Money input
  winEl.addEventListener('input',()=>{
    maskMoney(winEl);
    renderGrid(readMoney(winEl),currentRange[0],currentRange[1]);
  });

  // Range switching
  rangeButtons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      const [s,e]=btn.dataset.range.split(',').map(Number);
      currentRange=[s,e];
      setActive(btn);
      renderGrid(readMoney(winEl),s,e);
    });
  });

  // PWA SW (safe no-op if missing)
  if('serviceWorker'in navigator){navigator.serviceWorker.register('service-worker.js').catch(()=>{});}
}
if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",init);else init();
</script>
</body>
</html>
